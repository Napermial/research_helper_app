{% extends 'users/navbar.html' %}
{% block title %}{% endblock %}
{% block navbar %}{{ block.super }}{% endblock %}
{% block content %}
    <form>
        <script type="text/javascript">
            $(function () {
                $('[data-toggle="popover"]').popover({sanitize: false});
                $('[data-toggle="dropdown"]').dropdown()
            });
            let factorNames = []

            function addFactor() {
                let factorName = $("#factorName").val();
                factorNames.push(factorName)
                syncFactors()
            }

            function syncFactors() {
                let selects = document.querySelectorAll("[id^='FormSelectFactor']")
                let root = $('#dropdown_root')
                for (const node of selects) {
                    while (node.hasChildNodes()) {
                        node.removeChild(node.lastChild)
                    }
                    for (let factor of factorNames) {
                        node.appendChild(new Option(factor, ""))
                    }
                }
                root.empty()
                for (const factor of factorNames) {
                    root.append("<a class='dropdown-item' onclick='removeFactor(this)' >" + factor + "</a>")
                }

            }

            function changeNumberOfFactors() {
                let numberOfSelects = $("#factor_number").val()
                let root = $(".root-for-factor")
                root.empty()
                for (let i = 0; i < numberOfSelects; i++) {
                    let nameOfFactor = "FormSelectFactor" + i
                    let factor = '<div class="form-group"> <label for="' + nameOfFactor + '"  >select factor</label> <select class="form-control" id="' + nameOfFactor + '"> </select></div>'
                    root.append(factor)
                }
                syncFactors()
            }

            function removeFactor(factor) {
                factorNames = factorNames.filter(item => item !== factor.text)
                syncFactors()
            }
        </script>

        <div class="form-group">
            <label for="FormFactorNumber">Enter the number of factors</label>
            <input type="number" id="factor_number" onchange="changeNumberOfFactors()" value="1">
            <button type="button" class="btn btn-secondary" data-container="body" data-html="true" data-toggle="popover"
                    id="add_dissmissable"
                    data-placement="top" data-content='<input type="factor" id="factorName" placeholder="add name to factor">
                    <button type="button" onclick="addFactor()" class="btn btn-light">Add</button>'>
                Add Factor
            </button>
            <button class="btn btn-danger dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                Remove factor
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2" id="dropdown_root">
            </div>

        </div>
        <div class="root-for-factor">
        </div>
        <div class="form-group">
            <label for="FormFactorNumber">Enter the number of levels</label>
            <input type="number" id="level_number" onchange="changeNumberOfLevels()" value="1">
            <button type="button" class="btn btn-secondary" data-container="body" data-html="true" data-toggle="popover"
                    data-placement="top" data-content='<input type="level" id="levelName" placeholder="add name to level">
                    <button type="button" onclick="addLevel()" class="btn btn-light">Add</button>'>
                Add Factor
            </button>
            <button class="btn btn-danger dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                Remove factor
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenu2" id="dropdown_root">
            </div>

        </div>

    </form>
{% endblock %}